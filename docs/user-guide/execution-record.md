# 作業証跡記録ガイド

このガイドでは、OpsCoreの作業証跡機能について説明します。

## 目次

- [作業証跡とは](#作業証跡とは)
- [作業証跡の作成](#作業証跡の作成)
- [ステップの記録](#ステップの記録)
- [画面キャプチャの添付](#画面キャプチャの添付)
- [作業の完了・失敗](#作業の完了失敗)
- [作業証跡の共有](#作業証跡の共有)
- [作業証跡の検索](#作業証跡の検索)

## 作業証跡とは

作業証跡は、手順書を実行した際の記録です。以下の情報を記録できます：

- **実行者**: 誰が実行したか
- **実行日時**: いつ実行したか
- **変数値**: どのような設定値で実行したか
- **作業ステップ**: 各ステップの実施記録
- **画面キャプチャ**: 作業結果のスクリーンショット
- **作業メモ**: 補足情報や気づき
- **ステータス**: 進行中/完了/失敗

### メリット

- **トレーサビリティ**: 作業履歴の追跡
- **ナレッジ共有**: 成功・失敗事例の共有
- **監査対応**: 作業の証明
- **改善活動**: 作業時間や課題の分析

## 作業証跡の作成

### 基本的な作成手順

```
1. ドキュメントを開く
2. 必要に応じて変数を入力
3. 右ペインの「作業証跡を開始」ボタンをクリック
4. 作業証跡のタイトルを入力
5. 「開始」ボタンをクリック
```

### 作業証跡フォーム

```
┌─────────────────────────────┐
│ 作業証跡                     │
├─────────────────────────────┤
│ タイトル *                   │
│ [本番環境デプロイ    ]      │
├─────────────────────────────┤
│ メモ                         │
│ [                    ]      │
│ [                    ]      │
├─────────────────────────────┤
│ ステータス: 進行中           │
│ 開始日時: 2024-01-15 10:30  │
├─────────────────────────────┤
│ 作業ステップ                 │
│ [+ ステップを追加]           │
└─────────────────────────────┘
```

## ステップの記録

### ステップの追加

```
1. 右ペインの「ステップを追加」ボタンをクリック
2. ステップ番号が自動採番される
3. ステップの説明を入力
4. 「保存」ボタンをクリック
```

### ステップの編集

```
1. 対象ステップをクリック
2. 説明を編集
3. メモを追加（任意）
4. 「保存」ボタンをクリック
```

### ステップの削除

```
1. 対象ステップの右上の「×」ボタンをクリック
2. 確認ダイアログで「削除」を選択
```

### ステップの例

```
ステップ 1: サーバーへのSSH接続
- 説明: production-web-01にSSH接続を確認
- メモ: 接続に成功。レスポンス正常。
- 実施日時: 2024-01-15 10:35

ステップ 2: アプリケーションの停止
- 説明: systemctl stop appでアプリケーションを停止
- メモ: 正常に停止。エラーログなし。
- 実施日時: 2024-01-15 10:36
- 添付: [screenshot_stop.png]

ステップ 3: デプロイの実行
- 説明: deploy.shスクリプトを実行
- メモ: v2.5.0へのデプロイ完了
- 実施日時: 2024-01-15 10:40
- 添付: [screenshot_deploy.png]
```

## 画面キャプチャの添付

### 添付方法

```
1. 対象ステップを開く
2. 「ファイルを添付」ボタンをクリック
3. 画像ファイルを選択（または ドラッグ&ドロップ）
4. アップロードを待つ
5. サムネイルが表示される
```

### 対応ファイル形式

- **画像形式**: PNG, JPEG, GIF
- **最大サイズ**: 5MB（推奨: 2MB以下）
- **枚数制限**: 1ステップあたり10枚まで

### 画像の表示

```
- サムネイル: 自動生成される
- クリックで拡大表示
- ダウンロード可能
```

### 画像の削除

```
1. サムネイルにマウスオーバー
2. 右上の「×」ボタンをクリック
3. 確認ダイアログで「削除」を選択
```

## 作業の完了・失敗

### 作業の完了

作業が正常に完了した場合：

```
1. 右ペイン上部の「完了」ボタンをクリック
2. 完了メモを入力（任意）
3. 「完了」ボタンをクリック
4. ステータスが「完了」に変更される
```

### 作業の失敗

作業中に問題が発生した場合：

```
1. 右ペイン上部の「失敗」ボタンをクリック
2. 失敗理由を入力（必須）
3. 「失敗としてマーク」ボタンをクリック
4. ステータスが「失敗」に変更される
```

### ステータスの再変更

```
1. 作業証跡詳細画面を開く
2. 「ステータスを変更」ボタンをクリック
3. 新しいステータスを選択
4. 理由を入力
5. 「変更」ボタンをクリック
```

## 作業証跡の共有

### 共有設定

デフォルトでは、作業証跡は実行者と管理者のみが閲覧できます。他のユーザーと共有する場合：

```
1. 作業証跡詳細画面を開く
2. 「共有」タブをクリック
3. 「ユーザーを追加」または「グループを追加」
4. 対象を検索して選択
5. 「追加」ボタンをクリック
```

### 共有の種類

- **Private**: 実行者と管理者のみ
- **Shared**: 指定したユーザー・グループと共有

### 共有の解除

```
1. 作業証跡詳細画面 → 「共有」タブ
2. 共有先一覧から対象を選択
3. 「削除」ボタンをクリック
```

## 作業証跡の検索

### 基本検索

```
1. ナビゲーションメニュー → 「作業証跡」
2. 検索バーにキーワードを入力
3. Enterキーを押す
```

### フィルタリング

#### ステータス別

```
- 進行中
- 完了
- 失敗
```

#### 実行者別

```
1. 左サイドバーの「実行者」セクション
2. ユーザーを選択
```

#### 期間別

```
1. 左サイドバーの「期間」セクション
2. 日付範囲を選択
   - 今日
   - 今週
   - 今月
   - カスタム期間
```

#### ドキュメント別

```
1. 左サイドバーの「ドキュメント」セクション
2. 対象の手順書を選択
```

### 高度な検索

```
1. 検索バーの右側の「高度な検索」をクリック
2. 複数の条件を組み合わせ:
   - タイトル
   - ステータス
   - 実行者
   - 実行日
   - 使用した変数値
3. 「検索」ボタンをクリック
```

## 作業証跡の閲覧

### 一覧表示

```
作業証跡一覧画面では、以下が表示されます：
- タイトル
- ドキュメント名
- 実行者
- ステータス
- 実行日時
- 所要時間
```

### 詳細表示

```
作業証跡をクリックすると詳細が表示されます：
- 基本情報
- 使用した変数値
- 作業ステップ一覧
- 添付ファイル
- タイムライン
```

### エクスポート（将来実装予定）

```
1. 作業証跡詳細画面を開く
2. 「エクスポート」ボタンをクリック
3. 形式を選択（PDF, Markdown）
4. 「ダウンロード」ボタンをクリック
```

## ベストプラクティス

### 1. リアルタイムでの記録

作業を実施しながら、リアルタイムでステップを記録しましょう。

### 2. 画面キャプチャの活用

重要な画面や結果は必ず画面キャプチャを残しましょう。

### 3. 詳細なメモ

- 気づいたこと
- 通常と異なる点
- 改善提案

これらを積極的にメモしましょう。

### 4. 失敗記録の共有

失敗した作業証跡も貴重なナレッジです。隠さずに共有しましょう。

### 5. 定期的なレビュー

作業証跡を定期的にレビューし、手順書の改善に活かしましょう。

## トラブルシューティング

### Q: 画像がアップロードできない

**A**: 以下を確認してください：
- ファイルサイズが5MB以下か
- 対応形式（PNG, JPEG, GIF）か
- ネットワーク接続が正常か

### Q: 作業証跡が保存されない

**A**: 以下を確認してください：
- 必須項目（タイトル）が入力されているか
- ブラウザのエラーコンソールを確認
- ネットワーク接続が正常か

### Q: 過去の作業証跡が見つからない

**A**: 以下を確認してください：
- フィルター設定を確認
- 検索キーワードを確認
- 共有設定を確認（Privateの場合、実行者のみ閲覧可）

## 関連ドキュメント

- [ユーザーガイド](./README.md)
- [ドキュメント管理](./document-management.md)
- [変数入力機能](./variable-input.md)
- [ADR 0014: Execution Record and Evidence Management](../../adr/0014-execution-record-and-evidence-management.md)
