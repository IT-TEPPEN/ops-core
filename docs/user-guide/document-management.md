# ドキュメント管理ガイド

このガイドでは、OpsCoreでのドキュメント管理機能について説明します。

## 目次

- [リポジトリの登録](#リポジトリの登録)
- [ドキュメントの公開](#ドキュメントの公開)
- [バージョン管理](#バージョン管理)
- [アクセス制御](#アクセス制御)
- [ドキュメントの検索](#ドキュメントの検索)

## リポジトリの登録

### 概要

OpsCoreでは、GitHubやGitLabなどの外部リポジトリに保存された手順書を管理します。まず、リポジトリを登録する必要があります。

### 登録手順

#### 1. リポジトリ管理画面を開く

```
ナビゲーションメニュー → 「リポジトリ」
```

#### 2. 新規リポジトリの追加

```
1. 「新規リポジトリ追加」ボタンをクリック
2. 必要な情報を入力
   - リポジトリ名: 表示用の名前（例: "運用手順書リポジトリ"）
   - リポジトリURL: GitリポジトリのURL（例: https://github.com/user/repo）
   - アクセストークン: GitHubのPersonal Access Token
3. 「登録」ボタンをクリック
```

### アクセストークンの取得（GitHub）

```
1. GitHubにログイン
2. Settings → Developer settings → Personal access tokens → Tokens (classic)
3. 「Generate new token (classic)」をクリック
4. 以下の権限を付与:
   - repo (フルアクセス)
   - read:org (組織のリポジトリの場合)
5. トークンをコピーして、OpsCoreに貼り付け
```

**注意**: アクセストークンは暗号化されてデータベースに保存されます。

### リポジトリの編集・削除

#### 編集
```
1. リポジトリ一覧から対象リポジトリを選択
2. 「編集」ボタンをクリック
3. 必要な情報を更新
4. 「保存」ボタンをクリック
```

#### 削除
```
1. リポジトリ一覧から対象リポジトリを選択
2. 「削除」ボタンをクリック
3. 確認ダイアログで「削除」を選択
```

**注意**: リポジトリを削除すると、関連するドキュメントも削除されます。

## ドキュメントの公開

### ドキュメントの作成準備

#### Markdownファイルの準備

手順書はMarkdown形式で作成します。ファイルの先頭にFrontmatterを追加します：

```markdown
---
title: サーバーデプロイ手順
type: procedure
tags: [deploy, production, server]
category: deployment
owner: ops-team
variables:
  - name: server_name
    label: サーバー名
    description: デプロイ先のサーバー名を入力
    type: string
    required: true
    defaultValue: server01
  - name: deploy_date
    label: デプロイ日時
    description: デプロイ予定日時
    type: date
    required: true
---

# サーバーデプロイ手順

## 概要
この手順書は、{{server_name}}へのデプロイ手順を説明します。

## 手順
1. サーバーにログイン: `ssh {{server_name}}`
2. ...
```

### 公開手順

#### 1. ドキュメント管理画面を開く

```
ナビゲーションメニュー → 「ドキュメント管理」
```

#### 2. 新規ドキュメントの作成

```
1. 「新規ドキュメント」ボタンをクリック
2. 必要な情報を入力:
   - リポジトリ: 対象リポジトリを選択
   - ファイルパス: リポジトリ内のパス（例: docs/deploy.md）
   - 自動更新: リポジトリ更新時に自動反映するか
   - アクセス範囲: public または private
3. 「作成」ボタンをクリック
```

#### 3. ドキュメントの公開

```
1. ドキュメント一覧から対象ドキュメントを選択
2. 「公開」ボタンをクリック
3. 確認ダイアログで「公開」を選択
```

### 公開状態の管理

#### 非公開化

```
1. ドキュメント一覧から対象ドキュメントを選択
2. 「非公開にする」ボタンをクリック
3. 確認ダイアログで「非公開」を選択
```

#### 自動更新の設定

自動更新を有効にすると、リポジトリが更新された際に自動的に最新版が公開されます。

```
1. ドキュメント詳細画面を開く
2. 「設定」タブをクリック
3. 「自動更新」トグルをON
4. 「保存」ボタンをクリック
```

## バージョン管理

### バージョンの確認

```
1. ドキュメント詳細画面を開く
2. 「バージョン」タブをクリック
3. バージョン履歴が表示されます:
   - バージョン番号
   - コミットハッシュ
   - 公開日時
   - 非公開日時（該当する場合）
```

### 過去バージョンへのロールバック

```
1. 「バージョン」タブで対象バージョンを選択
2. 「このバージョンにロールバック」ボタンをクリック
3. 確認ダイアログで「ロールバック」を選択
```

**注意**: ロールバックしても、公開状態は維持されます。

### バージョン間の差分表示

```
1. 「バージョン」タブで2つのバージョンを選択
2. 「差分を表示」ボタンをクリック
3. 変更箇所がハイライト表示されます
```

## アクセス制御

### アクセス範囲の設定

#### Public（公開）

全てのユーザーが閲覧できます。

```
1. ドキュメント詳細画面を開く
2. 「設定」タブをクリック
3. アクセス範囲: 「Public」を選択
4. 「保存」ボタンをクリック
```

#### Private（非公開・共有）

特定のユーザーまたはグループのみが閲覧できます。

```
1. ドキュメント詳細画面を開く
2. 「設定」タブをクリック
3. アクセス範囲: 「Private」を選択
4. 「共有先を追加」ボタンをクリック
5. ユーザーまたはグループを選択
6. 「保存」ボタンをクリック
```

### 共有の管理

#### 共有先の追加

```
1. ドキュメント詳細画面 → 「共有」タブ
2. 「ユーザーを追加」または「グループを追加」
3. 対象を検索して選択
4. 「追加」ボタンをクリック
```

#### 共有の解除

```
1. ドキュメント詳細画面 → 「共有」タブ
2. 共有先一覧から対象を選択
3. 「削除」ボタンをクリック
```

## ドキュメントの検索

### キーワード検索

```
1. 上部の検索バーにキーワードを入力
2. Enterキーを押す
3. 検索結果が表示されます
```

### タグによるフィルタリング

```
1. ドキュメント一覧画面を開く
2. 左サイドバーの「タグ」セクションから選択
3. 選択したタグのドキュメントが表示されます
```

### カテゴリによるフィルタリング

```
1. ドキュメント一覧画面を開く
2. 左サイドバーの「カテゴリ」セクションから選択
3. 選択したカテゴリのドキュメントが表示されます
```

### 高度な検索

```
1. 検索バーの右側の「高度な検索」をクリック
2. 複数の条件を設定:
   - タイトル
   - タグ（複数選択可）
   - カテゴリ
   - 作成者
   - 公開日
3. 「検索」ボタンをクリック
```

## ベストプラクティス

### 1. 命名規則

- **タイトル**: 明確で検索しやすい名前
- **タグ**: 統一された用語を使用
- **カテゴリ**: 階層構造を考慮

### 2. バージョン管理

- 重要な変更時は必ずコミットメッセージを記載
- 定期的にバージョンの整理

### 3. アクセス制御

- 機密情報を含む手順書は必ずPrivateに設定
- 定期的にアクセス権限を見直し

### 4. メンテナンス

- 古くなった手順書は非公開化またはアーカイブ
- 定期的に内容を更新

## トラブルシューティング

### Q: ドキュメントが表示されない

**A**: 以下を確認してください：
- リポジトリのアクセストークンが有効か
- ファイルパスが正しいか
- Frontmatterの形式が正しいか

### Q: 自動更新が動作しない

**A**: 以下を確認してください：
- 自動更新設定がONになっているか
- リポジトリへのアクセス権限があるか
- Webhookが設定されているか（将来実装予定）

### Q: バージョンのロールバックができない

**A**: 以下を確認してください：
- 管理者権限があるか
- 対象バージョンが存在するか
- ネットワーク接続が正常か

## 関連ドキュメント

- [ユーザーガイド](./README.md)
- [変数入力機能](./variable-input.md)
- [作業証跡記録](./execution-record.md)
